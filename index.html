<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Индивидуальный маршрут</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      margin-top: 1em;
    }
    table, th, td {
      border: 1px solid #333;
      padding: 4px 8px;
    }
  </style>
</head>
<body>
  <h2>Индивидуальный маршрут</h2>
  <div id="output">Загрузка данных...</div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const fioTarget = urlParams.get('fio');

    if (!fioTarget) {
      document.getElementById('output').textContent = 'ФИО не указано в ссылке. Пример: ?fio=Иванов%20Иван';
    } else {
      const csvUrl = 'https://cloud.vrnds.ru/s/nptyBaYiPgpK2T3/download';

      fetch(csvUrl)
        .then(response => response.text())
        .then(csvText => {
          const rows = csvText.trim().split('\n').map(line => line.split(','));
          const headers = rows[0];
          const dataRows = rows.slice(1);

          const filtered = dataRows.filter(row => row[0].trim().toLowerCase() === fioTarget.trim().toLowerCase());

          if (filtered.length === 0) {
            document.getElementById('output').textContent = 'Нет данных для: ' + fioTarget;
            return;
          }

          const table = document.createElement('table');
          const thead = document.createElement('thead');
          const headerRow = document.createElement('tr');
          headers.forEach(h => {
            const th = document.createElement('th');
            th.textContent = h;
            headerRow.appendChild(th);
          });
          thead.appendChild(headerRow);
          table.appendChild(thead);

          const tbody = document.createElement('tbody');
          filtered.forEach(row => {
            const tr = document.createElement('tr');
            row.forEach(cell => {
              const td = document.createElement('td');
              td.textContent = cell;
              tr.appendChild(td);
            });
            tbody.appendChild(tr);
          });
          table.appendChild(tbody);

          const outputDiv = document.getElementById('output');
          outputDiv.innerHTML = '';
          outputDiv.appendChild(table);
        })
        .catch(error => {
          document.getElementById('output').textContent = 'Ошибка загрузки данных';
          console.error(error);
        });
    }
  </script>
</body>
</html>
